http:
  routers:
    # Frontend - Règle par défaut pour tout le trafic qui n'est pas une API
    frontend:
      rule: "PathPrefix(`/`)"
      service: frontend
      priority: 1
      entryPoints:
        - websecure
      tls: {}

    # Microservices
    membership:
      rule: "PathPrefix(`/api/membership`)"
      service: membership
      priority: 10
      entryPoints:
        - websecure
      middlewares:
        - membership-stripprefix
      tls: {}

    product:
      rule: "PathPrefix(`/api/product`)"
      service: product
      priority: 10
      entryPoints:
        - websecure
      middlewares:
        - product-stripprefix
      tls: {}

    order:
      rule: "PathPrefix(`/api/order`)"
      service: order
      priority: 10
      entryPoints:
        - websecure
      middlewares:
        - order-stripprefix
      tls: {}

  services:
    frontend:
      loadBalancer:
        servers:
          - url: "http://ms-ecommerce-ui:5173"

    membership:
      loadBalancer:
        servers:
          - url: "http://ms-membership:8081"

    product:
      loadBalancer:
        servers:
          - url: "http://ms-product:8082"

    order:
      loadBalancer:
        servers:
          - url: "http://ms-order:8083"

  middlewares:
    membership-stripprefix:
      stripPrefix:
        prefixes:
          - "/api/membership"

    product-stripprefix:
      stripPrefix:
        prefixes:
          - "/api/product"

    order-stripprefix:
      stripPrefix:
        prefixes:
          - "/api/order"

tls:
  certificates:
    - certFile: /etc/traefik/certs/localhost.crt
      keyFile: /etc/traefik/certs/localhost.key
